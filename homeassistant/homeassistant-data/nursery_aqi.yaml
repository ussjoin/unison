# AQI Calculation from https://www.airnow.gov/sites/default/files/2020-05/aqi-technical-assistance-document-sept2018.pdf p14
- sensor:
  - name: "Nursery AQI"
    unique_id: "nursery_aqi"
    unit_of_measurement: "aqi"
    state: >
      {% set pm = states('sensor.airlink_pm_2_5') | float %}
      {% if pm <= 12.0 %}
        {% set low = 0.0 %}
        {% set high = 50.0 %}
        {% set lowpm = 0.0 %}
        {% set highpm = 12.0 %}
      {% elif pm <= 35.4 %}
        {% set low = 50.0 %}
        {% set high = 100.0 %}
        {% set lowpm = 12.1 %}
        {% set highpm = 35.4 %}
      {% elif pm <= 55.4 %}
        {% set low = 101.0 %}
        {% set high = 150.0 %}
        {% set lowpm = 35.5 %}
        {% set highpm = 55.4 %}
      {% elif pm <= 150.4 %}
        {% set low = 151.0 %}
        {% set high = 200.0 %}
        {% set lowpm = 55.5 %}
        {% set highpm = 150.4 %}
      {% elif pm <= 250.4 %}
        {% set low = 201.0 %}
        {% set high = 300.0 %}
        {% set lowpm = 150.5 %}
        {% set highpm = 250.4 %}
      {% elif pm <= 350.4  %}
        {% set low = 301.0 %}
        {% set high = 400.0 %}
        {% set lowpm = 250.5 %}
        {% set highpm = 350.4 %}
      {% elif pm <= 500.4 %}
        {% set low = 401.0 %}
        {% set high = 500.0 %}
        {% set lowpm = 350.5 %}
        {% set highpm = 500.4 %}
      {% else %}
        {% set low = 501.0 %}
        {% set high = 502.0 %}
        {% set lowpm = 500.5 %}
        {% set highpm = 15000.0 %}
      {% endif %}
      {% set i_diff = high-low %}
      {% set pm_diff = highpm-lowpm %}
      {% set conc = pm-lowpm %}
      {{ ((conc * ((i_diff) / pm_diff)) + low) | round(0) }}

